# BITCH Configuration
# See DOCUMENTATION.md for complete documentation

[network]
gcs_listen_port = 14550
gcs_listen_address = "0.0.0.0"
router_address = "127.0.0.1"
router_port = 14551

[logging]
level = "info"  # trace, debug, info, warn, error

[plugins]
directory = "plugins"

[plugins.load]
arm_notifier = "arm_notifier.lua"
# webhook_example = "webhook_example.lua"

[modifiers]
directory = "modifiers"

[modifiers.load]
always_armed = "always_armed.lua"

# Rules - See DOCUMENTATION.md for complete rule system documentation
# Direction: "gcs_to_router" (default), "router_to_gcs", or "both"
# Actions: forward, block, modify, delay, batch

[[rules]]
message_type = "COMMAND_LONG"
actions = ["batch", "delay"]
batch_count = 2
batch_timeout_seconds = 60
batch_timeout_forward = true
batch_key = "arm_swarm"
batch_system_id_field = "target_system"  # Generic: extract from target_system field
delay_seconds = 5
auto_ack = true
ack_message_type = "COMMAND_ACK"  # Generic: specify ACK message type
ack_source_system_field = "target_system"  # Generic: extract from message
ack_source_component_field = "target_component"  # Generic: extract from message
plugins = ["arm_notifier"]
direction = "gcs_to_router"
description = "Synchronize ARM commands across 2 drones, then delay 5s before arming"

[rules.conditions]
command = "MAV_CMD_COMPONENT_ARM_DISARM"  # Generic field matching (not special-cased!)
param1 = 1.0  # Generic field matching (no longer explicit struct field!)

[rules.ack_fields]
result = "MAV_RESULT_ACCEPTED"  # Generic: ACK message fields

# Make all drones appear armed in HEARTBEAT messages
[[rules]]
message_type = "HEARTBEAT"
actions = ["modify", "forward"]
modifier = "always_armed"
direction = "router_to_gcs"
description = "Show drones as always armed"
